<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>你不知道的JavaScript（上卷） | lyyourc</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <link rel="shortcut icon" href="/favicon.ico">
  <link rel="stylesheet" href="/css/app.css">
  <!-- <link rel='stylesheet' href='http://fonts.useso.com/css?family=Source+Code+Pro'> -->
  
</head>

<body>
  <nav class="app-nav">
  
    
      <a href="/.">home</a>
    
  
    
      <a href="/archives">archive</a>
    
  
    
      <a href="/atom.xml">rss</a>
    
  
</nav>

  <main class="post">
  <article>
  <h1 class="article-title">
    <a href="/2016/12/29/你不知道的JavaScript（上卷）/">你不知道的JavaScript（上卷）</a>
  </h1>

  <section class="article-meta">
    <p class="article-date">December 29 2016</p>
  </section>

  <section class="article-entry">
    <h1 id="你不知道的JavaScript-上卷"><a href="#你不知道的JavaScript-上卷" class="headerlink" title="你不知道的JavaScript(上卷)"></a>你不知道的JavaScript(上卷)</h1><h2 id="第一部分-作用域和闭包"><a href="#第一部分-作用域和闭包" class="headerlink" title="第一部分 作用域和闭包"></a>第一部分 作用域和闭包</h2><h3 id="第1章-作用域是什么"><a href="#第1章-作用域是什么" class="headerlink" title="第1章 作用域是什么"></a>第1章 作用域是什么</h3><h4 id="编译原理"><a href="#编译原理" class="headerlink" title="编译原理"></a>编译原理</h4><ul>
<li>JS是一门编译语言</li>
<li>编译的三个步骤<ul>
<li>分词/词法分析(Tokenizing/Lexing)–将程序段分解为词法单元</li>
<li>解析/语法解析(Parsing)–将词法单元转换成一个由元素嵌套所组成的代表程序语法的”抽象语法树”(Abstract Syntax Tree,AST)</li>
<li>代码生成–将AST转换为可执行代码的过程，与语言、目标平台等息息相关。</li>
</ul>
</li>
<li>JS代码片段执行前都需要进行编译，但不一定是整个文件一起编译。</li>
</ul>
<h4 id="理解作用域"><a href="#理解作用域" class="headerlink" title="理解作用域"></a>理解作用域</h4><ul>
<li>引擎的LHS(写入)引用和RHS(读取)引用</li>
<li>在当前作用域中无法找到某个变量时，引擎就会在外层嵌套的作用域中继续查找，直到找到该变量或抵达最外层作用域为止。</li>
<li>RHS查询一个未声明的变量时会抛出ReferenceError,在非严格模式下进行一个未声明变量的LHS查询时会在全局作用域创建该变量。</li>
</ul>
<h3 id="第2章-词法作用域"><a href="#第2章-词法作用域" class="headerlink" title="第2章 词法作用域"></a>第2章 词法作用域</h3><ul>
<li>名词解释:词法作用域，产生于词法分析阶段，只由函数被声明时所处的位置决定。</li>
<li>词法作用域查找只会查找一级标识符,如果代码中引用了foo.bar.baz,词法作用域只会视图查找foo标识符</li>
<li>运行时修改词法作用域</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//使用eval,动态的修改了b,遮蔽了外部的b</span></div><div class="line"><span class="comment">//严格模式下eval会生成自己的作用域，并不会遮蔽变量</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params">str,a</span>)</span>&#123;</div><div class="line">    <span class="built_in">eval</span>(str);</div><div class="line">    <span class="built_in">console</span>.log(a,b);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> b=<span class="number">2</span>;</div><div class="line"><span class="comment">//1,3</span></div><div class="line">foor(<span class="string">"var b = 3;"</span>,<span class="number">1</span>);</div><div class="line"></div><div class="line"><span class="comment">//使用with</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params">obj</span>)</span>&#123;</div><div class="line">    <span class="keyword">with</span>(obj)&#123;</div><div class="line">        a = <span class="number">2</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> o1 = &#123;</div><div class="line">    <span class="attr">a</span>:<span class="number">3</span></div><div class="line">&#125;;</div><div class="line"><span class="keyword">var</span> o2 = &#123;</div><div class="line">    <span class="attr">b</span>:<span class="number">3</span></div><div class="line">&#125;;</div><div class="line"></div><div class="line">foo(o1);</div><div class="line"><span class="built_in">console</span>.log(o1.a);<span class="comment">//2</span></div><div class="line"></div><div class="line"><span class="comment">//相当于在o2中对a进行了LHS查询</span></div><div class="line">foo(o2);</div><div class="line"><span class="built_in">console</span>.log(o2.a);<span class="comment">//undefined</span></div><div class="line"><span class="built_in">console</span>.log(a);<span class="comment">//2</span></div></pre></td></tr></table></figure>
<ul>
<li>Tips:如果在with中使用var声明变量，变量会被提升到上一层的作用域中。</li>
<li>使用了eval和with无法在编译期进行性能优化</li>
</ul>
<h3 id="第3章-函数作用域和块作用域"><a href="#第3章-函数作用域和块作用域" class="headerlink" title="第3章 函数作用域和块作用域"></a>第3章 函数作用域和块作用域</h3><ul>
<li>函数可以产生一个作用域，可以使用该作用域进行对象的隐藏，作为局部作用域。</li>
<li>任何库都应该在全局作用域产生一个独特的对象，将暴露的API作为该对象的属性，防止多个库的冲突。</li>
<li>(function (){..})();函数表达式不会污染外部的命名空间(不产生函数名,覆盖变量名)</li>
<li>匿名函数的缺点<ul>
<li>匿名函数在栈追踪中不会显示出有意义的函数名，使得调试很困难。</li>
<li>没有函数名，无法解除事件绑定。</li>
<li>使得代码可读性、可理解性降低。</li>
</ul>
</li>
<li><p>块级作用域</p>
<ul>
<li>try{}catch(e){} //catch内部为块级作用域</li>
<li>(function(){..})()</li>
<li>let声明块级作用域在{..}中</li>
</ul>
</li>
<li><p>let声明的变量没有作用域提升,重构时需要付出额外的精力</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//undefined</span></div><div class="line"><span class="comment">//a提升(a被视为存在于其所出现的作用域的整个范围内)</span></div><div class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="built_in">console</span>.log(a);<span class="keyword">var</span> a = <span class="number">1</span>;&#125;());</div><div class="line"></div><div class="line"><span class="comment">//Uncaught ReferenceError: a is not defined</span></div><div class="line"><span class="comment">//不存在提升</span></div><div class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="built_in">console</span>.log(a);<span class="keyword">let</span> a = <span class="number">1</span>;&#125;)();</div><div class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="built_in">console</span>.log(a);&#125;());</div></pre></td></tr></table></figure>
<ul>
<li>块级作用域的变量执行完毕后将会被垃圾回收装置回收</li>
</ul>
<h3 id="第4章-提升"><a href="#第4章-提升" class="headerlink" title="第4章 提升"></a>第4章 提升</h3><ul>
<li>编译阶段中的一部分工作就是找到所有的声明，并用合适的作用域将它们关联起来,词法作用域的核心内容。因此，包括变量和函数在内的所有生命都会在任何代码被执行前首先被处理。</li>
<li>var a = 2;会被分解为两步第一步为var a;(编译时,就好像将声明提升到了作用域的开头) 第二步a = 2;(执行时)</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">foo();<span class="comment">//TypeError</span></div><div class="line">bar();<span class="comment">//ReferenceError</span></div><div class="line"><span class="keyword">var</span> foo = <span class="function"><span class="keyword">function</span> <span class="title">bar</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="comment">//...</span></div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">//相当于</span></div><div class="line"><span class="keyword">var</span> foo;</div><div class="line">foo();<span class="comment">//TypeError</span></div><div class="line">bar();<span class="comment">//ReferenceError</span></div><div class="line">foo = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> bar = ...self...</div><div class="line">    <span class="comment">//...</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>函数优先</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">foo();<span class="comment">//1</span></div><div class="line"></div><div class="line"><span class="keyword">var</span> foo;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="number">1</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line">foo = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="number">2</span>);</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="number">3</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//会被引擎理解为</span></div><div class="line"><span class="comment">//var foo;是重复的声明(因此被忽略了),但是后出现的函数还是可以覆盖前面的</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="number">1</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="number">3</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line">foo();<span class="comment">//1</span></div><div class="line"></div><div class="line">foo = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="number">2</span>);</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<ul>
<li>注意块级作用域情况，并不影响提升</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">foo();<span class="comment">//"b"</span></div><div class="line"><span class="keyword">var</span> a = <span class="literal">true</span>;</div><div class="line"><span class="keyword">if</span>(a)&#123;</div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>)</span>&#123;<span class="built_in">console</span>.log(<span class="string">"a"</span>);&#125;</div><div class="line">&#125;<span class="keyword">else</span>&#123;</div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>)</span>&#123;<span class="built_in">console</span>.log(<span class="string">"b"</span>);&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="第5章-作用域闭包"><a href="#第5章-作用域闭包" class="headerlink" title="第5章 作用域闭包"></a>第5章 作用域闭包</h3><ul>
<li>无论通过何种手段将内部函数传递到所在的词法作用域以外，它都会持有对原始定义作用域的引用，无论在何处执行这个函数都会使用闭包。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> b = <span class="number">1</span>,a = <span class="number">2</span>;</div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">bar</span>(<span class="params">str</span>)</span>&#123;</div><div class="line">        <span class="built_in">eval</span>(str);</div><div class="line">    &#125; </div><div class="line">    <span class="built_in">window</span>.bar = bar;</div><div class="line">&#125;</div><div class="line">foo();</div><div class="line">bar(<span class="string">"console.log(a);"</span>);<span class="comment">//2</span></div><div class="line">bar(<span class="string">"console.log(b);"</span>);<span class="comment">//1</span></div></pre></td></tr></table></figure>
<ul>
<li>只要内部作用域存在，外部作用域中的变量就不会被垃圾回收器回收</li>
<li>函数在定义时作用域范围已经固定，因而产生闭包</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>)</span>&#123;</div><div class="line">   <span class="keyword">var</span> a = <span class="number">2</span>;</div><div class="line">   <span class="function"><span class="keyword">function</span> <span class="title">bar</span>(<span class="params"></span>)</span>&#123;<span class="built_in">console</span>.log(a);<span class="built_in">console</span>.log(c);<span class="built_in">console</span>.log(d);&#125;</div><div class="line">   baz(bar);</div><div class="line">&#125;</div><div class="line"><span class="keyword">var</span> c = <span class="number">3</span>;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">baz</span>(<span class="params">fn</span>)</span>&#123;</div><div class="line">  <span class="keyword">var</span> c = <span class="number">4</span>,d = <span class="number">7</span>;</div><div class="line">  fn();</div><div class="line">&#125;</div><div class="line">foo();</div><div class="line"><span class="comment">//结果为</span></div><div class="line"><span class="comment">//2</span></div><div class="line"><span class="comment">//3</span></div><div class="line"><span class="comment">//ReferenceError</span></div></pre></td></tr></table></figure>
<ul>
<li><p>区分是否是闭包的方法</p>
<ul>
<li>函数是否引用外部作用域的变量。</li>
<li>是否是在定义的作用域被执行。</li>
</ul>
</li>
<li><p>模块模式的两个必要条件</p>
<ul>
<li>必须有外部的封闭函数，该函数必须至少被调用一次。</li>
<li>封闭函数必须返回至少一个内部函数，这样内部函数才能在私有作用域中形成闭包，并且可以访问或者修改私有的状态。</li>
</ul>
</li>
<li><p>模块实例</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> MyModules = (<span class="function"><span class="keyword">function</span> <span class="title">Manager</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> modules = &#123;&#125;;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">define</span>(<span class="params">name,deps,impl</span>)</span>&#123;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>,len=deps.length;i&lt;len;i++)&#123;</div><div class="line">            deps[i] = modules[deps[i]];</div><div class="line">        &#125;</div><div class="line">        <span class="comment">//配置函数/对象到模块中  取得依赖的模块并产生新模块</span></div><div class="line">        modules[name] = impl.apply(impl,deps);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get</span>(<span class="params">name</span>)</span>&#123;</div><div class="line">        <span class="keyword">return</span> modules[name];</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> &#123;</div><div class="line">        <span class="attr">define</span>:define,</div><div class="line">        <span class="attr">get</span>:get</div><div class="line">    &#125;</div><div class="line">&#125;)();</div><div class="line"></div><div class="line"><span class="comment">//封装模块</span></div><div class="line"></div><div class="line">MyModules.define(<span class="string">"bar"</span>,[],<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">hello</span>(<span class="params">who</span>)</span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="string">"Let me introduce: "</span>+who;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> &#123;</div><div class="line">        <span class="attr">hello</span>:hello</div><div class="line">    &#125;</div><div class="line">&#125;);</div><div class="line"></div><div class="line">MyModules.define(<span class="string">"foo"</span>,[<span class="string">"bar"</span>],<span class="function"><span class="keyword">function</span>(<span class="params">bar</span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> hungry = <span class="string">"hippo"</span>;</div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">awesome</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(bar.hello(hungry).toUpperCase());</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> &#123;</div><div class="line">        <span class="attr">awesome</span>:awesome</div><div class="line">    &#125;;</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">//调用模块</span></div><div class="line"></div><div class="line"><span class="keyword">var</span> bar = MyModules.get(<span class="string">"bar"</span>),</div><div class="line">    foo = MyModules.get(<span class="string">"foo"</span>);</div><div class="line"></div><div class="line"><span class="comment">//Let me introduce: hippo</span></div><div class="line"><span class="built_in">console</span>.log(bar.hello(<span class="string">"hippo"</span>));</div><div class="line"><span class="comment">//LET ME INTRODUCE: HIPPO</span></div><div class="line">foo.awesome();</div></pre></td></tr></table></figure>
<h3 id="附录A-动态作用域"><a href="#附录A-动态作用域" class="headerlink" title="附录A 动态作用域"></a>附录A 动态作用域</h3><ul>
<li>JS中只存在词法作用域不存在动态作用域</li>
<li>this机制某种程度上很像动态作用域</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="comment">//2:词法作用域(3:动态作用域)</span></div><div class="line">    <span class="built_in">console</span>.log(a);<span class="comment">//2</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">bar</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> a = <span class="number">3</span>;</div><div class="line">    foo();</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> a = <span class="number">2</span>;</div><div class="line">bar();</div></pre></td></tr></table></figure>
<h3 id="附录B-块作用域的替代方案"><a href="#附录B-块作用域的替代方案" class="headerlink" title="附录B 块作用域的替代方案"></a>附录B 块作用域的替代方案</h3><ul>
<li>Traceur将ES6的新特性，变成ES5的代码</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span>(a = <span class="number">2</span>)&#123;</div><div class="line">    <span class="built_in">console</span>.log(a);<span class="comment">//2</span></div><div class="line">&#125;</div><div class="line"><span class="built_in">console</span>.log(a);<span class="comment">//ReferenceError</span></div></pre></td></tr></table></figure>
<ul>
<li>ES6并不支持这种语法，可以使用作者的工具let-er将这种语法转换成标准的语法。</li>
</ul>
<h3 id="附录C-this词法"><a href="#附录C-this词法" class="headerlink" title="附录C this词法"></a>附录C this词法</h3><ul>
<li>箭头函数放弃了所有普通this的绑定规则,取而代之的是用当前词法作用域覆盖了this本来的值</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> obj = &#123;</div><div class="line">    <span class="attr">count</span>:<span class="number">0</span>,</div><div class="line">    <span class="attr">cool</span>:<span class="function"><span class="keyword">function</span> <span class="title">coolFn</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> self = <span class="keyword">this</span>;</div><div class="line">        <span class="keyword">if</span>(self.count&lt;<span class="number">1</span>)&#123;</div><div class="line">            setTimeout(<span class="function"><span class="keyword">function</span> <span class="title">timer</span>(<span class="params"></span>)</span>&#123;</div><div class="line">                self.count++;</div><div class="line">                <span class="built_in">console</span>.log(<span class="string">"awesome?"</span>);</div><div class="line">                &#125;,<span class="number">100</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">//等价于</span></div><div class="line"><span class="keyword">var</span> obj = &#123;</div><div class="line">    <span class="attr">count</span>:<span class="number">0</span>,</div><div class="line">    <span class="attr">cool</span>:<span class="function"><span class="keyword">function</span> <span class="title">coolFn</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="keyword">if</span>(<span class="keyword">this</span>.count &lt; <span class="number">1</span>)&#123;</div><div class="line">            setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">                <span class="comment">//this.count;</span></div><div class="line">                <span class="built_in">console</span>.log(<span class="string">"awesome"</span>);</div><div class="line">                &#125;,<span class="number">100</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<h2 id="第二部分-this和对象原型"><a href="#第二部分-this和对象原型" class="headerlink" title="第二部分 this和对象原型"></a>第二部分 this和对象原型</h2><h3 id="第1章-关于this"><a href="#第1章-关于this" class="headerlink" title="第1章 关于this"></a>第1章 关于this</h3><ul>
<li>this是在运行时进行绑定的，并不是在编写时绑定，它的上下文取决于函数调用时的各种条件。this的绑定和函数声明的位置没有任何关系，只取决于函数的调用方式。</li>
<li>this不指向函数自身也不指向函数的词法作用域</li>
</ul>
<h3 id="第2章-this全面解析"><a href="#第2章-this全面解析" class="headerlink" title="第2章 this全面解析"></a>第2章 this全面解析</h3><h4 id="调用栈和调用位置"><a href="#调用栈和调用位置" class="headerlink" title="调用栈和调用位置"></a>调用栈和调用位置</h4><ul>
<li>调用栈(使用在函数中打断点的方式通过控制台查看)和调用位置</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">baz</span>(<span class="params"></span>) </span>&#123;</div><div class="line"><span class="comment">// 当前调用栈是： baz</span></div><div class="line"><span class="comment">// 因此， 当前调用位置是全局作用域</span></div><div class="line"><span class="built_in">console</span>.log( <span class="string">"baz"</span> );</div><div class="line">    bar(); <span class="comment">// &lt;-- bar 的调用位置</span></div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">bar</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="comment">// 当前调用栈是 baz -&gt; bar</span></div><div class="line"><span class="comment">// 因此， 当前调用位置在 baz 中</span></div><div class="line"><span class="built_in">console</span>.log( <span class="string">"bar"</span> );</div><div class="line">    foo(); <span class="comment">// &lt;-- foo 的调用位置</span></div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</div><div class="line"><span class="comment">// 当前调用栈是 baz -&gt; bar -&gt; foo</span></div><div class="line"><span class="comment">// 因此， 当前调用位置在 bar 中</span></div><div class="line">    <span class="built_in">console</span>.log( <span class="string">"foo"</span> );</div><div class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>);</div><div class="line">&#125; </div><div class="line"></div><div class="line">baz(); <span class="comment">// &lt;-- baz 的调用位置</span></div></pre></td></tr></table></figure>
<h4 id="绑定规则"><a href="#绑定规则" class="headerlink" title="绑定规则"></a>绑定规则</h4><h5 id="默认绑定-绑定到window对象"><a href="#默认绑定-绑定到window对象" class="headerlink" title="默认绑定(绑定到window对象)"></a>默认绑定(绑定到window对象)</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.a);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> a = <span class="number">2</span>;</div><div class="line"></div><div class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    foo();<span class="comment">//2</span></div><div class="line">    &#125;)();</div></pre></td></tr></table></figure>
<ul>
<li>注意： 对于默认绑定来说， 决定this绑定对象的并不是调用位置是否处于严格模式， 而是函数体是否处于严格模式。 如果函数体处于严格模式,this 会被绑定到undefined， 否则this 会被绑定到全局对象。</li>
</ul>
<h5 id="隐式绑定"><a href="#隐式绑定" class="headerlink" title="隐式绑定"></a>隐式绑定</h5><ul>
<li>调用位置是否有上下文对象， 或者说是否被某个对象拥有或者包含</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.a);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> obj2 = &#123;</div><div class="line">    <span class="attr">a</span>:<span class="number">42</span>,</div><div class="line">    <span class="attr">foo</span>:foo</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">var</span> obj1 = &#123;</div><div class="line">    <span class="attr">a</span>:<span class="number">2</span>,</div><div class="line">    <span class="attr">obj2</span>:obj2</div><div class="line">&#125;;</div><div class="line"><span class="comment">//只跟最后一个对象有关</span></div><div class="line">obj1.obj2.foo();<span class="comment">//42</span></div></pre></td></tr></table></figure>
<ul>
<li>隐式丢失(将对象的函数赋值在调用，常见为将函数作为参数传入的情况)</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.a);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> obj = &#123;</div><div class="line">    <span class="attr">a</span>:<span class="number">2</span>,</div><div class="line">    <span class="attr">foo</span>:foo</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> a = <span class="string">"oops,global"</span>;<span class="comment">//a是全局对象的属性</span></div><div class="line"></div><div class="line">setTimeout(obj.foo,<span class="number">100</span>);</div></pre></td></tr></table></figure>
<ul>
<li>调用回调函数的函数可能会修改this,在库中尤为常见(一些流行的JS库中事件处理器会把回调函数的this强制绑定到触发事件的DOM元素上)</li>
</ul>
<h5 id="显示绑定"><a href="#显示绑定" class="headerlink" title="显示绑定"></a>显示绑定</h5><ul>
<li>使用函数call(),apply()和bind(…)进行对象绑定(将对象绑定到this)</li>
<li>注意:JS的宿主环境中有时会提供一些非常特殊的函数，它们并没有这两个方法。</li>
<li>如果传入一个原始值(字符串类型、布尔类型或者数字类型)来当作this的绑定对象，这个原始值会被转换成它的对象形式(也就是new String(…)、new Boolean(…)或者new Number(…))。这通常被称为”装箱”。</li>
<li>硬绑定(使用bind(…)方法进行绑定)</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params">something</span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.a,something);</div><div class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.a + something;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> obj = &#123;</div><div class="line">    <span class="attr">a</span>:<span class="number">2</span></div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">var</span> bar = foo.bind(obj);</div><div class="line"><span class="keyword">var</span> b = bar(<span class="number">3</span>);</div><div class="line"></div><div class="line"><span class="built_in">console</span>.log(b);</div></pre></td></tr></table></figure>
<ul>
<li>API调用”上下文”</li>
<li>第三方库的许多函数，以及JavaScript语言和宿主环境中许多新的内置函数，都提供了一个可选的参数，通常被称为”上下文”(context),其作用和bind(…)一样</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params">el</span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(el,<span class="keyword">this</span>.id);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> obj = &#123;</div><div class="line">    <span class="attr">id</span>:<span class="string">"awesome"</span></div><div class="line">&#125;;</div><div class="line"><span class="comment">//调用foo(...)时把this绑定到obj</span></div><div class="line">[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>].forEach(foo,obj);</div></pre></td></tr></table></figure>
<h5 id="new-绑定"><a href="#new-绑定" class="headerlink" title="new 绑定"></a>new 绑定</h5><ul>
<li>并不存在”构造函数”，只有对于函数的”构造调用”。</li>
<li>使用new来调用函数，或者说发生构造函数调用时，会自动执行下面的操作<ol>
<li>创建(或者说构造)一个全新的对象。</li>
<li>这个新对象会被执行[[原型]]连接。</li>
<li>这个新对象会绑定到函数调用的this。</li>
<li>如果函数没有返回其他对象，那么new表达式中的函数调用会自动返回这个新对象。</li>
</ol>
</li>
</ul>
<h4 id="优先级"><a href="#优先级" class="headerlink" title="优先级"></a>优先级</h4><ul>
<li>new 绑定 | 显示绑定 &gt; 隐式绑定 &gt; 默认绑定</li>
<li>在new中是哦越高硬绑定函数，主要目的是预设置函数的一些参数，这样在使用new进行初始化时就可以只传入其余的参数。( 这种技术称为“ 部分应用”， 是“ 柯里化” 的一种)</li>
<li>bind(…)的功能之一就是可以把除了第一个参数(第一个参数用于绑定this)之外的其他参数都传给下层的函数。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params">p1,p2</span>)</span>&#123;</div><div class="line">    <span class="keyword">this</span>.val = p1 + p2;</div><div class="line">&#125;</div><div class="line"><span class="comment">//使用null是因为并不关心硬绑定的this是什么</span></div><div class="line"><span class="comment">//反正使用new时this会被修改</span></div><div class="line"><span class="keyword">var</span> bar = foo.bind(<span class="literal">null</span>,<span class="string">"p1"</span>);</div><div class="line"></div><div class="line"><span class="keyword">var</span> baz = <span class="keyword">new</span> bar(<span class="string">"p2"</span>);</div><div class="line"></div><div class="line">baz.val;<span class="comment">//p1p2</span></div></pre></td></tr></table></figure>
<h4 id="绑定例外"><a href="#绑定例外" class="headerlink" title="绑定例外"></a>绑定例外</h4><ul>
<li><p>如果把null或者undefined作为this的绑定对象传入call、apply或者bind,这些值在调用时会被忽略，实际应用的是默认绑定规则。</p>
</li>
<li><p>Object.create(null)不会创建Object.prototype这个委托，它比{}更空</p>
</li>
<li>传入空对象比传入null更加安全,防止污染全局变量</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params">a,b</span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">"a:"</span>+a+<span class="string">",b:"</span>+b);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 我们的 DMZ 空对象</span></div><div class="line"><span class="keyword">var</span> ø = <span class="built_in">Object</span>.create(<span class="literal">null</span>);</div><div class="line"></div><div class="line"><span class="comment">// 把数组展开成参数</span></div><div class="line">foo.apply(ø,[<span class="number">2</span>,<span class="number">3</span>]);</div><div class="line"></div><div class="line"><span class="comment">// 使用 bind(..) 进行柯里化</span></div><div class="line"><span class="keyword">var</span> bar = foo.bind(ø,<span class="number">2</span>);</div><div class="line">bar(<span class="number">3</span>);</div></pre></td></tr></table></figure>
<ul>
<li>间接引用</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.a);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> a = <span class="number">2</span>;</div><div class="line"><span class="keyword">var</span> o = &#123;<span class="attr">a</span>:<span class="number">3</span>,<span class="attr">foo</span>:foo&#125;;</div><div class="line"><span class="keyword">var</span> p = &#123;<span class="attr">a</span>:<span class="number">4</span>&#125;;</div><div class="line"></div><div class="line">o.foo();<span class="comment">//3</span></div><div class="line"><span class="comment">//这里应用的是默认绑定</span></div><div class="line"><span class="comment">//复制表达式返回值是目标函数的引用而不是p.foo()或者o.foo()</span></div><div class="line">(p.foo = o.foo)();<span class="comment">//2</span></div></pre></td></tr></table></figure>
<ul>
<li>软绑定(修改默认绑定，同时可以使用隐式绑定、显示绑定修改默认绑定)</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span>(!<span class="built_in">Function</span>.prototype.softBind)&#123;</div><div class="line">    <span class="built_in">Function</span>.prototype.softBind = <span class="function"><span class="keyword">function</span>(<span class="params">obj</span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> fn = <span class="keyword">this</span>;</div><div class="line">        <span class="comment">//捕获所有curried参数</span></div><div class="line">        <span class="keyword">var</span> curried = [].slice.call(<span class="built_in">arguments</span>,<span class="number">1</span>);</div><div class="line">        <span class="keyword">var</span> bound = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">            <span class="keyword">return</span> fn.apply(</div><div class="line">                (!<span class="keyword">this</span> || <span class="keyword">this</span> === (<span class="built_in">window</span> || global)) ? obj : <span class="keyword">this</span>,</div><div class="line">                curried.concat.apply(curried,<span class="built_in">arguments</span>)</div><div class="line">                );</div><div class="line">        &#125;;</div><div class="line">        bound.prototype = <span class="built_in">Object</span>.create(fn.prototype);</div><div class="line">        <span class="keyword">return</span> bound;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>软绑定的使用</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">"name:"</span>+<span class="keyword">this</span>.name);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> obj = &#123;<span class="attr">name</span>:<span class="string">"obj"</span>&#125;,</div><div class="line">    obj2 = &#123;<span class="attr">name</span>:<span class="string">"obj2"</span>&#125;,</div><div class="line">    obj3 = &#123;<span class="attr">name</span>:<span class="string">"obj3"</span>&#125;;</div><div class="line"><span class="keyword">var</span> fooOBJ = foo.softBind(obj);</div><div class="line"></div><div class="line"><span class="comment">//name:obj</span></div><div class="line">fooObj();</div><div class="line"></div><div class="line"><span class="comment">//name:obj2</span></div><div class="line">obj.foo = foo.softBind(obj);</div><div class="line">obj2.foo();</div><div class="line"></div><div class="line"><span class="comment">//name:obj3</span></div><div class="line">fooOBJ.call(obj3);</div><div class="line"></div><div class="line"><span class="comment">//name:obj  </span></div><div class="line">setTimeout(obj2.foo,<span class="number">10</span>);</div></pre></td></tr></table></figure>
<ul>
<li>箭头函数(this继承自外部函数)</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">        <span class="comment">//这里的this在此法上继承自foo()</span></div><div class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>.a);</div><div class="line">        &#125;,<span class="number">100</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> obj = &#123;</div><div class="line">    <span class="attr">a</span>:<span class="number">2</span></div><div class="line">&#125;;</div><div class="line"></div><div class="line">foo.call(obj); <span class="comment">//2</span></div></pre></td></tr></table></figure>
<h3 id="第3章-对象"><a href="#第3章-对象" class="headerlink" title="第3章 对象"></a>第3章 对象</h3><h4 id="对象类型"><a href="#对象类型" class="headerlink" title="对象类型"></a>对象类型</h4><ul>
<li>JS六种主要类型string,boolean,number,null,undefined(5种基本类型),object</li>
<li>内置对象String、Array…是一些可以当作构造函数的内置函数。</li>
<li>JS中也有自动装箱和拆箱的概念将字面量转换为相应的对象。(string,boolean和number)</li>
<li>数组和对象都根据自身的数据结构进行了优化，最好不要混用</li>
<li>数组字符串数字会被视为索引</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> myArray = [<span class="string">"foo"</span>,<span class="number">42</span>,<span class="string">"bar"</span>];</div><div class="line"></div><div class="line"><span class="comment">//添加了一个数组下标</span></div><div class="line">myArray[<span class="string">"3"</span>] = <span class="string">"baz"</span>;</div><div class="line"></div><div class="line"><span class="comment">//4</span></div><div class="line">myArray.length;</div><div class="line"><span class="comment">//"baz"</span></div><div class="line">myArray[<span class="number">3</span>];</div></pre></td></tr></table></figure>
<h4 id="对象复制"><a href="#对象复制" class="headerlink" title="对象复制"></a>对象复制</h4><ul>
<li>对象复制<ul>
<li>浅复制(复制值，复制引用的地址)</li>
<li>深复制(复制值，复制实际引用的空间)</li>
</ul>
</li>
<li>深复制的实现</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//只使用于JSON 安全（ 也就是说可以被序列化为一个JSON字符串并且可以根据这个字符串解析出一个结构和值完全一样的对象） 的对象</span></div><div class="line"><span class="keyword">var</span> newObj = <span class="built_in">JSON</span>.parse(<span class="built_in">JSON</span>.stringify(someObj));</div></pre></td></tr></table></figure>
<ul>
<li>浅复制的实现</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> anotherObject = &#123;&#125;;</div><div class="line"><span class="keyword">var</span> myObject = &#123;</div><div class="line">    <span class="attr">a</span>:<span class="number">2</span>,</div><div class="line">    <span class="attr">b</span>:anotherObject,</div><div class="line">&#125;;</div><div class="line"><span class="comment">//ES6中定义了Object.assign(..)方法来实现浅复制。</span></div><div class="line"><span class="comment">//Object.assign(..)遍历一个或多个源对象的所有可枚举（ enumerable， 参见下面的代码）的自有键（ owned key， 很快会介绍） 并把它们复制（ 使用 = 操作符赋值到目标对象， 最后返回目标对象</span></div><div class="line"><span class="keyword">var</span> newObj = <span class="built_in">Object</span>.assign(&#123;&#125;,myObject);</div><div class="line"></div><div class="line">newObj.a;<span class="comment">//2</span></div><div class="line">newObj.b === anotherObject;<span class="comment">//true</span></div></pre></td></tr></table></figure>
<ul>
<li>Tips:由于Object.assign(..)就是使用=操作符来赋值，所以源对象属性的一些特性(比如writable)不会被复制到目标对象。</li>
</ul>
<h4 id="对象属性描述符"><a href="#对象属性描述符" class="headerlink" title="对象属性描述符"></a>对象属性描述符</h4><ul>
<li>获取和设置属性描述符</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> myObject = &#123;</div><div class="line">    <span class="attr">a</span>:<span class="number">2</span></div><div class="line">&#125;;</div><div class="line"><span class="comment">//获取对应属性的属性描述符</span></div><div class="line"><span class="built_in">Object</span>.getOwnPropertyDescriptor(myObject,<span class="string">"a"</span>);</div><div class="line"><span class="comment">//&#123;</span></div><div class="line"><span class="comment">//  value:2,</span></div><div class="line"><span class="comment">//  writable:true,</span></div><div class="line"><span class="comment">//  enumerable:true,</span></div><div class="line"><span class="comment">//  configurable:true</span></div><div class="line"><span class="comment">//&#125;</span></div><div class="line"></div><div class="line"><span class="comment">//设置属性描述符</span></div><div class="line">Obejct.defineProperty(myObject,<span class="string">"b"</span>,&#123;</div><div class="line">    <span class="attr">value</span>:<span class="number">3</span>,</div><div class="line">    <span class="attr">writable</span>:<span class="literal">true</span>,</div><div class="line">    <span class="attr">configurable</span>:<span class="literal">true</span>,</div><div class="line">    <span class="attr">enumerable</span>:<span class="literal">true</span></div><div class="line">    &#125;);</div><div class="line"></div><div class="line">myObject.b;<span class="comment">//3</span></div></pre></td></tr></table></figure>
<ul>
<li>属性描述符<ul>
<li>value:属性的值</li>
<li>writable:决定属性的值是否可以被更改，严格模式下更改会报错</li>
<li>configurable:决定属性描述符是否可以配置。属性值可以被更改，不可以使用Object.defineProperty(..)配置属性描述符,也不可以删除属性;配置为false后进行修改会报错 </li>
<li>enumerable:这个描述符控制的是属性是否会出现在对象的属性枚举中,比如for…in循环。</li>
</ul>
</li>
<li>禁止扩展(禁止一个对象添加新属性并且保留已有属性，可以使用Object.preventExtensions(..))</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> myObject = &#123;</div><div class="line">    <span class="attr">a</span>:<span class="number">2</span></div><div class="line">&#125;;</div><div class="line"><span class="built_in">Object</span>.preventExtensions(myObject);</div><div class="line">myObject.b = <span class="number">3</span>;</div><div class="line"><span class="comment">//严格模式下将会抛出错误</span></div><div class="line">myObject.b;<span class="comment">//undefined</span></div></pre></td></tr></table></figure>
<ul>
<li>密封(Object.seal(..)会创建一个”密封”对象，相当于对这个对象调用Object.preventExtensions(..)并把所有属性标记为configurable:false)</li>
<li>冻结(Object.freeze(..)会创建一个冻结对象，这个方法实际会在一个现有对象上调用Object.seal(..)并把所有”数据访问”属性标记为writable:false)</li>
<li>深度冻结，遍历对象下的所有属性对每一个对象属性都调用Object.freeze(..)方法</li>
</ul>
<h4 id="Getter和Setter"><a href="#Getter和Setter" class="headerlink" title="Getter和Setter"></a>Getter和Setter</h4><ul>
<li>对象默认的[[Put]]和[[Get]]操作分别可以控制属性值的设置和获取<ul>
<li>[[Put]]调用过程<ol>
<li>属性是否是访问描述符？ 如果是并且存在 setter 就调用 setter。</li>
<li>属性的数据描述符中writable是否是false？如果是，在非严格模式下静默失败， 在严格模式下抛出 TypeError 异常。</li>
<li>如果都不是， 将该值设置为属性的值。</li>
</ol>
</li>
<li>[[Get]]调用过程，通过原型链查找是否具有该属性，如果没有该属性则返回undefined</li>
</ul>
</li>
<li>Getter和Setter将属性定义为”访问描述符”(和”数据描述符”相对),对于访问描述符来说，JS会忽略它们的value和writable特性，而关心set和get</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//定义get</span></div><div class="line"><span class="keyword">var</span> myObject = &#123;</div><div class="line">    <span class="comment">//给a定义一个getter</span></div><div class="line">    get a()&#123;</div><div class="line">        <span class="keyword">return</span> <span class="number">2</span>;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"><span class="built_in">Object</span>.defineProperty(myObject,<span class="string">"b"</span>,</div><div class="line">    &#123;</div><div class="line">        <span class="attr">get</span>:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">this</span>.a * <span class="number">2</span></div><div class="line">            &#125;,</div><div class="line">        <span class="attr">enumerable</span>:<span class="literal">true</span></div><div class="line">    &#125;</div><div class="line">);</div><div class="line"></div><div class="line">myObject.a; <span class="comment">//2</span></div><div class="line">myObject.b; <span class="comment">//4</span></div><div class="line"></div><div class="line"><span class="comment">//使用set和get定义对象</span></div><div class="line"><span class="keyword">var</span> myObject = &#123;</div><div class="line">    <span class="comment">//给a定义一个getter</span></div><div class="line">    get a()&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>._a_ ;</div><div class="line">    &#125;,</div><div class="line">    <span class="comment">//给a定义一个setter</span></div><div class="line">    set a(val)&#123;</div><div class="line">        <span class="keyword">this</span>._a_ = val*<span class="number">2</span>;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line">myObject.a = <span class="number">2</span>;</div><div class="line">myObject.a;<span class="comment">//4</span></div></pre></td></tr></table></figure>
<ul>
<li>判断属性是否存在</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> myObject = &#123;</div><div class="line">    <span class="attr">a</span>:<span class="number">2</span></div><div class="line">&#125;;</div><div class="line"><span class="comment">//in操作符会检查属性是否在对象及其[[Prototype]]原型链中</span></div><div class="line">(<span class="string">"a"</span> <span class="keyword">in</span> myObject);<span class="comment">//true</span></div><div class="line"><span class="comment">//只会检查属性是否在myObject对象中</span></div><div class="line">myObject.hasOwnProperty(<span class="string">"a"</span>);<span class="comment">//true</span></div><div class="line"><span class="comment">//等价于</span></div><div class="line"><span class="built_in">Object</span>.prototype.hasOwnProperty.call(myObject,<span class="string">"a"</span>);</div></pre></td></tr></table></figure>
<ul>
<li>Tips:数组使用for..in循环用来遍历对象的可枚举属性列表(包括[[Prototype]]链),数组最好使用for循环来遍历数组索引。</li>
<li>判断属性是否可枚举</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//判断属性是否可枚举</span></div><div class="line">myObject.propertyIsEnumerable(<span class="string">"a"</span>);<span class="comment">//true</span></div><div class="line">myObject.propertyIsEnumerable(<span class="string">"b"</span>);<span class="comment">//false</span></div><div class="line"></div><div class="line"><span class="comment">//返回myObject中所有可枚举的属性</span></div><div class="line"><span class="built_in">Object</span>.keys(myObject);<span class="comment">//["a"]</span></div><div class="line"><span class="comment">//返回myObject所有的属性</span></div><div class="line"><span class="built_in">Object</span>.getOwnPropertyNames(myObject);<span class="comment">//["a","b"]</span></div></pre></td></tr></table></figure>
<h4 id="遍历"><a href="#遍历" class="headerlink" title="遍历"></a>遍历</h4><ul>
<li>并没有内置的方法可以获取 in 操作符使用的属性列表;若要获取所有属性列表，可以使用递归遍历来获取</li>
<li>数组循环array.forEach(callback),array.every(callback)(直到回调函数返回false),array.some(callback)(直到回调函数返回true)</li>
<li>ES6的for..of语法来遍历数组结构(数组、对象等等)中的值,for..of会寻找内置或者自定义的@@iterator对象并调用它的next()方法来遍历数组值。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//自定义迭代器使用for..of遍历</span></div><div class="line"><span class="keyword">var</span> myObject = &#123;</div><div class="line">    <span class="attr">a</span>:<span class="number">2</span>,</div><div class="line">    <span class="attr">b</span>:<span class="number">3</span></div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="built_in">Object</span>.defineProperty(myObject,<span class="built_in">Symbol</span>.iterator,&#123;</div><div class="line">    <span class="attr">enumerable</span>:<span class="literal">false</span>,</div><div class="line">    <span class="attr">writable</span>:<span class="literal">false</span>,</div><div class="line">    <span class="attr">configurable</span>:<span class="literal">true</span>,</div><div class="line">    <span class="attr">value</span>:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> o = <span class="keyword">this</span>;</div><div class="line">        <span class="keyword">var</span> idx = <span class="number">0</span>;</div><div class="line">        <span class="keyword">var</span> ks = <span class="built_in">Object</span>.keys(o);</div><div class="line">        <span class="keyword">return</span> &#123;</div><div class="line">            <span class="attr">next</span>:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">                <span class="keyword">return</span> &#123;</div><div class="line">                    <span class="attr">value</span>:o[ks[id++]],</div><div class="line">                    <span class="attr">done</span>:(idx&gt;ks.length);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    &#125;);</div><div class="line"></div><div class="line"><span class="comment">//使用for..of遍历</span></div><div class="line"><span class="keyword">for</span>(<span class="keyword">var</span> v <span class="keyword">of</span> myObject)&#123;</div><div class="line">    <span class="built_in">console</span>.log(v);</div><div class="line">&#125;</div><div class="line"><span class="comment">//2</span></div><div class="line"><span class="comment">//3</span></div></pre></td></tr></table></figure>
<h3 id="第4章-混合对象”类”"><a href="#第4章-混合对象”类”" class="headerlink" title="第4章 混合对象”类”"></a>第4章 混合对象”类”</h3><ul>
<li>名词解释:类/继承描述了一种代码的组织结构形式–一种软件中对真实世界中问题领域的建模方法。</li>
<li>名词解释:多态指的是父类通用行为可以被子类用更特殊的行为重写</li>
<li>使用混入(mixin)来模拟类的复制行为</li>
<li>显示混入<ul>
<li>缺点:使用显式伪多态会在所有需要使（伪）多态引用的地方创建一个函数关联， 这会极大地增加维护成本;对象引用被修改时(如:给数组添加新元素)，函数</li>
</ul>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//也可以全复制，在掩盖。</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">mixin</span>(<span class="params">sourceObj,targetObj</span>)</span>&#123;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> key <span class="keyword">in</span> sourceObj)&#123;</div><div class="line">        <span class="comment">//只会在不存在的情况下复制</span></div><div class="line">        <span class="keyword">if</span>(!(key <span class="keyword">in</span> targetObj))&#123;</div><div class="line">            targetObj[key] = sourceObj[key];</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> targetObj;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> Vehicle = &#123;</div><div class="line">    <span class="attr">engines</span>:<span class="number">1</span>,</div><div class="line">    <span class="attr">ignition</span>:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">"Turning on my engine."</span>);</div><div class="line">    &#125;</div><div class="line">    drive:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="keyword">this</span>.ignition();</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">"Steering and moving forward!"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">var</span> Car = mixin(Vehicle,&#123;</div><div class="line">    <span class="attr">wheels</span>:<span class="number">4</span>,</div><div class="line">    <span class="attr">drive</span>:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="comment">//这里实现了多态</span></div><div class="line">        Vehicle.drive.call(<span class="keyword">this</span>);</div><div class="line">        <span class="built_in">console</span>.log(</div><div class="line">            <span class="string">"Rolling on all"</span>+<span class="keyword">this</span>.wheels+<span class="string">" wheels!"</span></div><div class="line">        );</div><div class="line">    &#125;</div><div class="line">    &#125;)</div></pre></td></tr></table></figure>
<ul>
<li>寄生继承</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//"传统的JavaScript类"Vehicle</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">Vehicle</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="keyword">this</span>.engines = <span class="number">1</span>;</div><div class="line">&#125;</div><div class="line">Vehicle.prototype.ignition = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">"Turning on my engine."</span>);</div><div class="line">&#125;;</div><div class="line">Vehicle.prototype.drive = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="keyword">this</span>.ignition();</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">"Steering and moving forward!"</span>);</div><div class="line">&#125;;</div><div class="line"><span class="comment">//"寄生类"Car</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">Car</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="comment">//首先,car是一个Vehicle</span></div><div class="line">    <span class="keyword">var</span> car = <span class="keyword">new</span> Vehicle();</div><div class="line"></div><div class="line">    <span class="comment">//接着我们对car进行定制</span></div><div class="line">    car.wheels = <span class="number">4</span>;</div><div class="line"></div><div class="line">    <span class="keyword">var</span> vehDrive = car.drive;</div><div class="line"></div><div class="line">    <span class="comment">//重写Vehicle::drive()</span></div><div class="line">    car.drive = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        vehDrive.call(<span class="keyword">this</span>);</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">"Rolling on all "</span>+<span class="keyword">this</span>.wheels+<span class="string">" wheels!"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">var</span> myCar = <span class="keyword">new</span> Car();</div><div class="line">myCar.drive();</div></pre></td></tr></table></figure>
<ul>
<li>隐式混入</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//解决了显示混入对象共享的问题</span></div><div class="line"><span class="keyword">var</span> Something = &#123;</div><div class="line">    <span class="attr">cool</span>:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="keyword">this</span>.array = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>];</div><div class="line">        <span class="keyword">this</span>.count = <span class="keyword">this</span>.count ? <span class="keyword">this</span>.count + <span class="number">1</span> : <span class="number">1</span>;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line">Something.cool();</div><div class="line">Something.array.push(<span class="number">4</span>);</div><div class="line">Something.array;<span class="comment">//[1,2,3,4]</span></div><div class="line">Something.count;<span class="comment">//1</span></div><div class="line"></div><div class="line"><span class="keyword">var</span> Another = &#123;</div><div class="line">    <span class="attr">cool</span>:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="comment">//隐式把Something混入Another</span></div><div class="line">        Something.cool.call(<span class="keyword">this</span>);</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line">Another.cool();</div><div class="line">Another.array;<span class="comment">//[1,2,3]</span></div><div class="line">Another.count;<span class="comment">//1 (count不是共享状态)</span></div></pre></td></tr></table></figure>
<ul>
<li>混入模式（无论显式还是隐式）可以用来模拟类的复制行为，但是通常会产生丑陋并且脆弱的语法</li>
</ul>
<h3 id="第5章-原型"><a href="#第5章-原型" class="headerlink" title="第5章 原型"></a>第5章 原型</h3><ul>
<li>所有普通(内置，不是特定的主机的扩展)的[[Prototype]]链最终都会指向内置的Object.prototype</li>
<li>属性只存在于对象原型链上层时:<ol>
<li>如果在 [[Prototype]] 链上层存在名为 foo 的普通数据访问属性并且没有被标记为只读（writable:true），那就会直接在myObject中添加一个名为foo的新属性， 它是屏蔽属性。</li>
<li>如果在 [[Prototype]]链上层存在foo，但是它被标记为只读（writable:false）， 那么无法修改已有属性或者在myObject上创建屏蔽属性。如果运行在严格模式下，代码会抛出一个错误。 否则,这条赋值语句会被忽略。 总之,不会发生屏蔽。</li>
<li>如果在 [[Prototype]]链上层存在foo并且它是一个setter，那就一定会调用这个 setter。 foo 不会被添加到（ 或者说屏蔽于）myObject，也不会重新定义foo 这个 setter。</li>
</ol>
</li>
<li><p>如果你希望在第二种和第三种情况下也屏蔽foo,那就不能使用 = 操作符来赋值，而是使用Object.defineProperty(..)来向myObject添加foo</p>
</li>
<li><p>原型是在调用new Foo()时创建的，最后被关联到这个”Foo.prototype”,以及返回的对象的prototype上。</p>
</li>
<li>对象上的constructor是来自原型链的</li>
<li>Foo.prototype的.constructor属性只是Foo函数在声明时的默认属性。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">Foo</span>(<span class="params"></span>)</span>&#123;<span class="comment">/*..*/</span>&#125;</div><div class="line"></div><div class="line">Foo.prototype = &#123;&#125;;</div><div class="line"></div><div class="line"><span class="keyword">var</span> a1 = <span class="keyword">new</span> Foo();</div><div class="line">a1.constructor === Foo;<span class="comment">//false</span></div><div class="line"><span class="comment">//constuctor是Object.prototype的属性</span></div><div class="line">a1.constructor === <span class="built_in">Object</span>;<span class="comment">//true</span></div></pre></td></tr></table></figure>
<ul>
<li>.constructor属性是一个可变(configurable)的、可修改(writable)的、不可枚举(enumerable)的属性</li>
<li>继承的方式</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//ES6之前需要抛弃默认的Bar.prototype</span></div><div class="line"><span class="comment">//需要重新绑定constructor</span></div><div class="line">Bar.prototype = <span class="built_in">Object</span>.create(Foo.prototype);</div><div class="line"></div><div class="line"><span class="comment">//ES6开始可以直接修改现有的Bar.prototype</span></div><div class="line"><span class="built_in">Object</span>.setPrototypeOf(Bar.prototype,Foo.prototype);</div></pre></td></tr></table></figure>
<ul>
<li>obj1.isPrototypeOf(obj2) 判断obj2整条原型链中是否存在obj1</li>
<li>Object.create(..)避免使用new的构造函数调用会生成.prototype和.constructor引用</li>
<li>模拟Object.create(..)</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span>(!<span class="built_in">Object</span>.create)&#123;</div><div class="line">    <span class="built_in">Object</span>.create = <span class="function"><span class="keyword">function</span>(<span class="params">o</span>)</span>&#123;</div><div class="line">        <span class="function"><span class="keyword">function</span> <span class="title">F</span>(<span class="params"></span>)</span>&#123;&#125;</div><div class="line">        F.prototype = o;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> F();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>使用清晰的API命名委托(即调用的API为原型的方法)</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> anotherObject = &#123;</div><div class="line">    <span class="attr">cool</span>:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">"cool!"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">var</span> myObject = <span class="built_in">Object</span>.create(anotherObject);</div><div class="line"></div><div class="line">myObject.doCool = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="comment">//内部委托!</span></div><div class="line">    <span class="keyword">this</span>.cool();</div><div class="line">&#125;;</div><div class="line"><span class="comment">//"cool!"</span></div><div class="line">myObject.doCool();</div></pre></td></tr></table></figure>
<h3 id="第6章-行为委托"><a href="#第6章-行为委托" class="headerlink" title="第6章 行为委托"></a>第6章 行为委托</h3><ul>
<li>禁止互相委托,如果你把B关联到A然后试着把A关联到B,就会出错。</li>
<li>Chrome跟踪函数名的方法</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> Foo = &#123;&#125;;</div><div class="line"></div><div class="line"><span class="keyword">var</span> a1 = <span class="built_in">Object</span>.create(Foo);</div><div class="line"></div><div class="line">a1;<span class="comment">//Object &#123;&#125;</span></div><div class="line"></div><div class="line"><span class="built_in">Object</span>.defineProperty(Foo,<span class="string">"constructor"</span>,&#123;</div><div class="line">    <span class="attr">enumerable</span>:<span class="literal">false</span>,</div><div class="line">    <span class="attr">value</span>:<span class="function"><span class="keyword">function</span> <span class="title">Gotcha</span>(<span class="params"></span>)</span>&#123;&#125;</div><div class="line">    &#125;);</div><div class="line"></div><div class="line">a1;<span class="comment">//Gotcha &#123;&#125;</span></div></pre></td></tr></table></figure>
<ul>
<li>面向对象和对象关联模型比较</li>
<li>面向对象模型</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//面向对象模型</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">Foo</span>(<span class="params">who</span>)</span>&#123;</div><div class="line">    <span class="keyword">this</span>.me = who;</div><div class="line">&#125;</div><div class="line">Foo.prototype.identify = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="string">"I am "</span>+<span class="keyword">this</span>.me;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">Bar</span>(<span class="params">who</span>)</span>&#123;</div><div class="line">    Foo.call(<span class="keyword">this</span>,who);</div><div class="line">&#125;</div><div class="line">Bar.prototype = <span class="built_in">Object</span>.create(Foo.prototype);</div><div class="line"></div><div class="line">Bar.prototype.speak = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    alert(<span class="string">"Hello, "</span>+<span class="keyword">this</span>.identify()+<span class="string">"."</span>);</div><div class="line">&#125;;</div><div class="line"><span class="keyword">var</span> b1 = <span class="keyword">new</span> Bar(<span class="string">"b1"</span>);</div><div class="line"><span class="keyword">var</span> b2 = <span class="keyword">new</span> Bar(<span class="string">"b2"</span>);</div></pre></td></tr></table></figure>
<ul>
<li>使用对象模型图</li>
</ul>
<p><img src="resources/images/使用对象模型.png" alt="使用对象模型"></p>
<ul>
<li>使用关联模型图</li>
</ul>
<p><img src="resources/images/使用关联模型.png" alt="使用关联模型"></p>
<ul>
<li>对象关联模型</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//对象关联模型</span></div><div class="line">Foo = &#123;</div><div class="line">    <span class="attr">init</span>:<span class="function"><span class="keyword">function</span>(<span class="params">who</span>)</span>&#123;</div><div class="line">        <span class="keyword">this</span>.me = who;</div><div class="line">    &#125;</div><div class="line">    identify:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="string">"I am "</span>+<span class="keyword">this</span>.me;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line">Bar = <span class="built_in">Object</span>.create(Foo);</div><div class="line"></div><div class="line">Bar.speak = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    alert(<span class="string">"Hello, "</span>+<span class="keyword">this</span>.identify()+<span class="string">"."</span>);</div><div class="line">&#125;;</div><div class="line"><span class="keyword">var</span> b1 = <span class="built_in">Object</span>.create(Bar);</div><div class="line">b1.init(<span class="string">"b1"</span>);</div><div class="line"><span class="keyword">var</span> b2 = <span class="built_in">Object</span>.create(Bar);</div><div class="line">b2.init(<span class="string">"b2"</span>);</div><div class="line"></div><div class="line">b1.speak();</div><div class="line">b2.speak();</div></pre></td></tr></table></figure>
<ul>
<li>关联风格思维模型</li>
</ul>
<p><img src="resources/images/关联风格思维模型.png" alt="关联风格思维模型"></p>
<ul>
<li><p>关联模型比对象模型更简洁(没有了类的模仿行为)</p>
</li>
<li><p>实例,创建UI控件</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/*=====使用类模式=====*/</span></div><div class="line"><span class="comment">//父类</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">Widget</span>(<span class="params">width,height</span>)</span>&#123;</div><div class="line">    <span class="keyword">this</span>.width = width || <span class="number">50</span>;</div><div class="line">    <span class="keyword">this</span>.height = height || <span class="number">50</span>;</div><div class="line">    <span class="keyword">this</span>.$elem = <span class="literal">null</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line">Widget.prototype.render = <span class="function"><span class="keyword">function</span>(<span class="params">$where</span>)</span>&#123;</div><div class="line">    <span class="keyword">if</span>(<span class="keyword">this</span>.$elem)&#123;</div><div class="line">        <span class="keyword">this</span>.$elem.css(&#123;</div><div class="line">            <span class="attr">width</span>:<span class="keyword">this</span>.width + <span class="string">"px"</span>,</div><div class="line">            <span class="attr">height</span>:<span class="keyword">this</span>.height + <span class="string">"px"</span></div><div class="line">            &#125;).appendTo($where);</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">//子类</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">Button</span>(<span class="params">width,height,label</span>)</span>&#123;</div><div class="line">    <span class="comment">//调用"super"构造函数</span></div><div class="line">    Widget.call(<span class="keyword">this</span>,width,height);</div><div class="line">    <span class="keyword">this</span>.label = label || <span class="string">"Default"</span>;</div><div class="line"></div><div class="line">    <span class="keyword">this</span>.$elem = $(<span class="string">"&lt;button&gt;"</span>).text(<span class="keyword">this</span>.label);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//让Button"继承"Widget</span></div><div class="line">Button.prototype = <span class="built_in">Object</span>.create(Widget.prototype);</div><div class="line"></div><div class="line"><span class="comment">//重写render(..)</span></div><div class="line">Button.prototype.render = <span class="function"><span class="keyword">function</span>(<span class="params">$where</span>)</span>&#123;</div><div class="line">    <span class="comment">//"super"调用</span></div><div class="line">    Widget.prototype.render.call(<span class="keyword">this</span>,$where);</div><div class="line">    <span class="keyword">this</span>.$elem.click(<span class="keyword">this</span>.onClick.bind(<span class="keyword">this</span>));</div><div class="line">&#125;;</div><div class="line"></div><div class="line">Button.prototype.onClick = <span class="function"><span class="keyword">function</span>(<span class="params">evt</span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">"Button '"</span>+<span class="keyword">this</span>.label+<span class="string">"' clicked!"</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line">$(<span class="built_in">document</span>).ready(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> $body = $(<span class="built_in">document</span>.body);</div><div class="line">    <span class="keyword">var</span> btn1 = <span class="keyword">new</span> Button(<span class="number">125</span>,<span class="number">30</span>,<span class="string">"Hello"</span>),</div><div class="line">        btn2 = <span class="keyword">new</span> Button(<span class="number">150</span>,<span class="number">40</span>,<span class="string">"World"</span>);</div><div class="line">    btn1.render($body);</div><div class="line">    btn2.render($body); </div><div class="line">    &#125;)</div><div class="line"></div><div class="line"><span class="comment">/*=====ES6 class=====*/</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Widget</span></span>&#123;</div><div class="line">    <span class="keyword">constructor</span>(width,height)&#123;</div><div class="line">        <span class="keyword">this</span>.width = width || <span class="number">50</span>;</div><div class="line">        <span class="keyword">this</span>.height = height || <span class="number">50</span>;</div><div class="line">        <span class="keyword">this</span>.$elem = <span class="literal">null</span>;</div><div class="line">    &#125;</div><div class="line">    render($where)&#123;</div><div class="line">        <span class="keyword">if</span>(<span class="keyword">this</span>.$elem)&#123;</div><div class="line">            <span class="keyword">this</span>.$elem.css(&#123;</div><div class="line">                <span class="attr">width</span>:<span class="keyword">this</span>.width + <span class="string">"px"</span>,</div><div class="line">                <span class="attr">height</span>:<span class="keyword">this</span>.height + <span class="string">"px"</span></div><div class="line">                &#125;).appendTo($where);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Button</span> <span class="keyword">extends</span> <span class="title">Widget</span></span>&#123;</div><div class="line">    <span class="keyword">constructor</span>(width,height,label)&#123;</div><div class="line">        <span class="keyword">super</span>(width,height);</div><div class="line">        <span class="keyword">this</span>.label = label || <span class="string">"Default"</span>;</div><div class="line">        <span class="keyword">this</span>.$elem = $(<span class="string">"&lt;button&gt;"</span>).text(<span class="keyword">this</span>.label);</div><div class="line">    &#125;</div><div class="line">    render($where)&#123;</div><div class="line">        <span class="keyword">super</span>($where);</div><div class="line">        <span class="keyword">this</span>.$elem.click(<span class="keyword">this</span>.onClick.bind(<span class="keyword">this</span>));</div><div class="line">    &#125;</div><div class="line">    onClick(evt)&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">"Button '"</span>+<span class="keyword">this</span>.label+<span class="string">"' clicked!"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">$(<span class="built_in">document</span>).ready(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> $body = $(<span class="built_in">document</span>.body);</div><div class="line">    <span class="keyword">var</span> btn1 = <span class="keyword">new</span> Button(<span class="number">125</span>,<span class="number">30</span>,<span class="string">"Hello"</span>),</div><div class="line">        btn2 = <span class="keyword">new</span> Button(<span class="number">150</span>,<span class="number">40</span>,<span class="string">"World"</span>);</div><div class="line">        </div><div class="line">    btn1.render($body);</div><div class="line">    btn2.render($body);</div><div class="line">    &#125;)</div><div class="line"></div><div class="line"><span class="comment">/*=====使用关联模式=====*/</span></div><div class="line"><span class="keyword">var</span> Widget = &#123;</div><div class="line">    <span class="attr">init</span>:<span class="function"><span class="keyword">function</span>(<span class="params">width,height</span>)</span>&#123;</div><div class="line">        <span class="keyword">this</span>.width = width || <span class="number">50</span>;</div><div class="line">        <span class="keyword">this</span>.height = height || <span class="number">50</span>;</div><div class="line">        <span class="keyword">this</span>.$elem = <span class="literal">null</span>;</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">insert</span>:<span class="function"><span class="keyword">function</span>(<span class="params">$where</span>)</span>&#123;</div><div class="line">        <span class="keyword">if</span>(<span class="keyword">this</span>.$elem)&#123;</div><div class="line">            <span class="keyword">this</span>.$elem.css(&#123;</div><div class="line">                <span class="attr">width</span>:<span class="keyword">this</span>.width + <span class="string">"px"</span>,</div><div class="line">                <span class="attr">height</span>:<span class="keyword">this</span>.height + <span class="string">"px"</span></div><div class="line">                &#125;).appendTo($where);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">var</span> Button = <span class="built_in">Object</span>.create(Widget);</div><div class="line"></div><div class="line">Button.setup = <span class="function"><span class="keyword">function</span>(<span class="params">width,height,label</span>)</span>&#123;</div><div class="line">    <span class="comment">//委托调用</span></div><div class="line">    <span class="keyword">this</span>.init(width,height);</div><div class="line">    <span class="keyword">this</span>.label = label || <span class="string">"Default"</span>;</div><div class="line"></div><div class="line">    <span class="keyword">this</span>.$elem = $(<span class="string">"&lt;button&gt;"</span>).text(<span class="keyword">this</span>.label);</div><div class="line">&#125;;</div><div class="line"></div><div class="line">Button.build = <span class="function"><span class="keyword">function</span>(<span class="params">$where</span>)</span>&#123;</div><div class="line">    <span class="comment">//委托调用</span></div><div class="line">    <span class="keyword">this</span>.insert($where);</div><div class="line">    <span class="keyword">this</span>.$elem.click(<span class="keyword">this</span>.onClick.bind(<span class="keyword">this</span>));</div><div class="line">&#125;;</div><div class="line"></div><div class="line">Button.onClick = <span class="function"><span class="keyword">function</span>(<span class="params">evt</span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">"Button '"</span> + <span class="keyword">this</span>.label + <span class="string">"' clicked!"</span>);</div><div class="line">&#125;;</div><div class="line"></div><div class="line">$(<span class="built_in">document</span>).ready(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> $body = $(<span class="built_in">document</span>.body);</div><div class="line"></div><div class="line">    <span class="keyword">var</span> btn1 = <span class="built_in">Object</span>.create(Button);</div><div class="line">    btn1.setup(<span class="number">150</span>,<span class="number">40</span>,<span class="string">"Hello"</span>);</div><div class="line"></div><div class="line">    <span class="keyword">var</span> btn2 = <span class="built_in">Object</span>.create(Button);</div><div class="line">    btn2.setup(<span class="number">150</span>,<span class="number">40</span>,<span class="string">"World"</span>);</div><div class="line"></div><div class="line">    btn1.build($body);</div><div class="line">    btn2.build($body);</div><div class="line">    &#125;)</div></pre></td></tr></table></figure>
<ul>
<li>关联模型将对象创建以及初始化分为两个步骤更加灵活(可以使用对象池放置对象，取出时再进行初始化。)</li>
<li>实例,控制器</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/*=====使用类模型=====*/</span></div><div class="line"><span class="comment">//父类</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">Controller</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="keyword">this</span>.errors = [];</div><div class="line">&#125;</div><div class="line">Controller.prototype.showDialog(title,msg)&#123;</div><div class="line">    <span class="comment">//给用户显示标题和消息</span></div><div class="line">&#125;;</div><div class="line">Controller.prototype.success = <span class="function"><span class="keyword">function</span>(<span class="params">msg</span>)</span>&#123;</div><div class="line">    <span class="keyword">this</span>.showDialog(<span class="string">"Success"</span>,msg);</div><div class="line">&#125;;</div><div class="line">Controller.prototype.failure = <span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;</div><div class="line">    <span class="keyword">this</span>.errors.push(err);</div><div class="line">    <span class="keyword">this</span>.showDialog(<span class="string">"Error"</span>,err);</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">//子类</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">LoginController</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    Controller.call(<span class="keyword">this</span>);</div><div class="line">&#125;</div><div class="line"><span class="comment">//把子类关联到父类</span></div><div class="line">LoginController.prototype = <span class="built_in">Object</span>.create(Controller.prototype);</div><div class="line">LoginController.prototype.getUser = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="built_in">document</span>.getElementById(<span class="string">"login_username"</span>).value;</div><div class="line">&#125;;</div><div class="line">LoginController.prototype.getPassword = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="built_in">document</span>.getElementById(<span class="string">"login_password"</span>).value;</div><div class="line">&#125;;</div><div class="line">LoginController.prototype.validateEntry = <span class="function"><span class="keyword">function</span>(<span class="params">user,pw</span>)</span>&#123;</div><div class="line">    user = user || <span class="keyword">this</span>.getUser();</div><div class="line">    pw = pw || <span class="keyword">this</span>.getPassword();</div><div class="line"></div><div class="line">    <span class="keyword">if</span>(!(user &amp;&amp; pw))&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.failure(<span class="string">"Please enter a username &amp; password!"</span>);</div><div class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(user.length &lt; <span class="number">5</span>)&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.failure(<span class="string">"Password must be 5+ characters!"</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="comment">//如果执行到这里说明通过验证</span></div><div class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">&#125;;</div><div class="line"><span class="comment">//重写基础的failure()</span></div><div class="line">LoginController.prototype.failure = <span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;</div><div class="line">    <span class="comment">//"super"调用</span></div><div class="line">    Controller.prototype.failure.call(</div><div class="line">        <span class="keyword">this</span>,</div><div class="line">        <span class="string">"Login invalid: "</span> + err);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//子类</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">AuthController</span>(<span class="params">login</span>)</span>&#123;</div><div class="line">    Controller.call(<span class="keyword">this</span>);</div><div class="line">    <span class="comment">//合成</span></div><div class="line">    <span class="keyword">this</span>.login = login;</div><div class="line">&#125;</div><div class="line"><span class="comment">//把子类关联到父类</span></div><div class="line">AuthController.prototype = <span class="built_in">Object</span>.create(Controller.prototype);</div><div class="line">AuthController.prototype.server = <span class="function"><span class="keyword">function</span>(<span class="params">url,data</span>)</span>&#123;</div><div class="line">    <span class="keyword">return</span> $.ajax(&#123;</div><div class="line">        <span class="attr">url</span>:url,</div><div class="line">        <span class="attr">data</span>:data</div><div class="line">        &#125;);</div><div class="line">&#125;;</div><div class="line">AuthController.prototype.checkAuth = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> user = <span class="keyword">this</span>.login.getUser();</div><div class="line">    <span class="keyword">var</span> pw = <span class="keyword">this</span>.login.getPassword();</div><div class="line"></div><div class="line">    <span class="keyword">if</span>(<span class="keyword">this</span>.login.validateEntry(user,pw))&#123;</div><div class="line">        <span class="keyword">this</span>.server(<span class="string">"/check-auth"</span>,&#123;</div><div class="line">            <span class="attr">user</span>:user,</div><div class="line">            <span class="attr">pw</span>:pw</div><div class="line">            &#125;)</div><div class="line">            .then(<span class="keyword">this</span>.success.bind(<span class="keyword">this</span>))</div><div class="line">            .fail(<span class="keyword">this</span>.failure.bind(<span class="keyword">this</span>));</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"><span class="comment">//重写基础的success()</span></div><div class="line">AuthController.prototype.success = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="comment">//"super"调用</span></div><div class="line">    Controller.prototype.success.call(<span class="keyword">this</span>,<span class="string">"Authenticated!"</span>);</div><div class="line">&#125;</div><div class="line"><span class="comment">//重写基础的failure()</span></div><div class="line">AuthController.prototype.failure = <span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;</div><div class="line">    <span class="comment">//"super"调用</span></div><div class="line">    Controller.prototype.failure.call(err)&#123;</div><div class="line">        <span class="keyword">this</span>,</div><div class="line">        <span class="string">"Auth Failed: "</span> + err</div><div class="line">    &#125;;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">var</span> auth = <span class="keyword">new</span> AuthController();</div><div class="line">auth.checkAuth(</div><div class="line">    <span class="comment">//除了继承、我们还需要合成</span></div><div class="line">    <span class="keyword">new</span> LoginController());</div><div class="line"></div><div class="line"><span class="comment">/*=====使用关联模型=====*/</span></div><div class="line"><span class="keyword">var</span> LoginController = &#123;</div><div class="line">    <span class="attr">errors</span>:[],</div><div class="line">    <span class="attr">getUser</span>:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="built_in">document</span>.getElementById(<span class="string">"login_username"</span>).value;</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">getPassword</span>:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="built_in">document</span>.getElementById(<span class="string">"login_password"</span>).value;</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">validateEntry</span>:<span class="function"><span class="keyword">function</span>(<span class="params">user,pw</span>)</span>&#123;</div><div class="line">        user = user || <span class="keyword">this</span>.getUser();</div><div class="line">        pw = pw || <span class="keyword">this</span>.getPassword();</div><div class="line"></div><div class="line">        <span class="keyword">if</span>(!(user &amp;&amp; pw))&#123;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">this</span>.failure(<span class="string">"Please enter a username &amp; password!"</span>);</div><div class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(user.length &lt; <span class="number">5</span>)&#123;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">this</span>.failure(<span class="string">"Password must be 5+ characters!"</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="comment">//如果执行到这里说明通过验证</span></div><div class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">showDialog</span>:<span class="function"><span class="keyword">function</span>(<span class="params">title,msg</span>)</span>&#123;</div><div class="line">        <span class="comment">//给用户显示标题和消息</span></div><div class="line">    &#125;,</div><div class="line">    <span class="attr">failure</span>:<span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;</div><div class="line">        <span class="keyword">this</span>.errors.push(err);</div><div class="line">        <span class="keyword">this</span>.showDialog(<span class="string">"Error"</span>,<span class="string">"Login invalid: "</span> + err);</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">//让AuthController委托LoginController</span></div><div class="line"><span class="keyword">var</span> AuthController = <span class="built_in">Object</span>.create(LoginController);</div><div class="line"></div><div class="line">AuthController.errors = [];</div><div class="line">AuthController.checkAuth = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> user = <span class="keyword">this</span>.getUser();</div><div class="line">    <span class="keyword">var</span> pw = <span class="keyword">this</span>.getPassword();</div><div class="line"></div><div class="line">    <span class="keyword">if</span>(<span class="keyword">this</span>.validateEntry(user,pw))&#123;</div><div class="line">        <span class="keyword">this</span>.server(<span class="string">"/check-auth"</span>,&#123;</div><div class="line">            <span class="attr">user</span>:user,</div><div class="line">            <span class="attr">pw</span>:pw</div><div class="line">            &#125;)</div><div class="line">            .then(<span class="keyword">this</span>.accepted.bind(<span class="keyword">this</span>))</div><div class="line">            .fail(<span class="keyword">this</span>.rejected.bind(<span class="keyword">this</span>));</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line">AuthController.server = <span class="function"><span class="keyword">function</span>(<span class="params">url,data</span>)</span>&#123;</div><div class="line">    <span class="keyword">return</span> $.ajax(&#123;</div><div class="line">        <span class="attr">url</span>:url,</div><div class="line">        <span class="attr">data</span>:data</div><div class="line">        &#125;);</div><div class="line">&#125;;</div><div class="line">AuthController.accepted = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="keyword">this</span>.showDialog(<span class="string">"Success"</span>,<span class="string">"Authenticated!"</span>);</div><div class="line">&#125;;</div><div class="line">AuthController.rejected = <span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;</div><div class="line">    <span class="keyword">this</span>.failure(<span class="string">"Auth Failed: "</span> + err);</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<ul>
<li>具名函数能够自我引用</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> Foo = &#123;</div><div class="line">    <span class="comment">//匿名函数不能自我引用</span></div><div class="line">    bar:<span class="function"><span class="keyword">function</span>(<span class="params">x</span>)</span>&#123;</div><div class="line">        <span class="keyword">if</span>(x &lt; <span class="number">10</span>)&#123;</div><div class="line">            <span class="keyword">return</span> Foo.bar(x * <span class="number">2</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> x;</div><div class="line">    &#125;,</div><div class="line">    <span class="comment">//具名函数能够自我引用</span></div><div class="line">    baz:<span class="function"><span class="keyword">function</span> <span class="title">baz</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="keyword">if</span>(x &lt; <span class="number">10</span>)&#123;</div><div class="line">            <span class="keyword">return</span> baz(x * <span class="number">2</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> x;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="附录A-ES6中的Class"><a href="#附录A-ES6中的Class" class="headerlink" title="附录A ES6中的Class"></a>附录A ES6中的Class</h3><ul>
<li>class使用的是原型的机制(而不是函数复制)，即修改父类的方法子类会受到影响</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span></span>&#123;</div><div class="line">    <span class="keyword">constructor</span>()&#123;</div><div class="line">        <span class="keyword">this</span>.num = <span class="built_in">Math</span>.random();</div><div class="line">    &#125;</div><div class="line">    rand()&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">"Random: "</span> + <span class="keyword">this</span>.num);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>修改共有状态暴露了原型</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span></span>&#123;</div><div class="line">    <span class="keyword">constructor</span>()&#123;</div><div class="line">        <span class="comment">//确保修改的是共享状态而不是实例上创建的一个屏蔽属性!</span></div><div class="line">        C.prototype.count++;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">//this.count 可以通过委托实现我们想要的功能</span></div><div class="line">    <span class="built_in">console</span>.log(<span class="string">"Hello: "</span> + <span class="keyword">this</span>.count);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//直接向prototype对象添加一个共享状态</span></div><div class="line">C.prototype.count = <span class="number">0</span>;</div><div class="line"></div><div class="line"><span class="keyword">var</span> c1 = <span class="keyword">new</span> C();</div><div class="line"><span class="comment">//Hello:1</span></div><div class="line"><span class="keyword">var</span> c2 = <span class="keyword">new</span> C();</div><div class="line"><span class="comment">//Hello:2</span></div><div class="line">c1.count === <span class="number">2</span>;<span class="comment">//true</span></div><div class="line">c1.count === c2.count;<span class="comment">//true</span></div></pre></td></tr></table></figure>
<ul>
<li>super并不是动态绑定，它会在声明时静态绑定。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">P</span></span>&#123;</div><div class="line">    foo()&#123;<span class="built_in">console</span>.log(<span class="string">"P.foo"</span>);&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span> <span class="keyword">extends</span> <span class="title">P</span></span>&#123;</div><div class="line">    foo()&#123;</div><div class="line">        <span class="keyword">super</span>();</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> c1 = <span class="keyword">new</span> C();</div><div class="line">c1.foo();<span class="comment">//"P.foo"</span></div><div class="line"></div><div class="line"><span class="keyword">var</span> D = &#123;</div><div class="line">    <span class="attr">foo</span>:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="built_in">console</span>.log(<span class="string">"D.foo"</span>);&#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">var</span> E = &#123;</div><div class="line">    <span class="attr">foo</span>:C.prototype.foo</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">//把E委托到D</span></div><div class="line"><span class="built_in">Object</span>.setPrototypeOf(E,D);</div><div class="line"></div><div class="line">E.foo();<span class="comment">//"P.foo"不是"D.foo"</span></div><div class="line"></div><div class="line"><span class="comment">//手动绑定super</span></div><div class="line">E.foo = C.prototype.foo.toMethod(E,<span class="string">"foo"</span>);</div><div class="line"></div><div class="line">E.foo();<span class="comment">//"D.foo"</span></div></pre></td></tr></table></figure>

  </section>
</article>

  <div class="sharing grid">
  <section class="profile grid-item grid">
    <img class="avatar" src="http://7xrcp8.com1.z0.glb.clouddn.com/avatar.png" alt="avatar" />
    <div class="grid-item">
      <p class="title"> lyyourc </p>
      <p class="subtitle"> You Are The JavaScript In My HTML </p>
    <div>
  </section>

  <section class="share-btns">
    <!-- <p> share it if you like it~ </p> -->
    <a
  class="twitter-share-button"
  data-size="large"
  data-via="DrakeLeung"
  href="https://twitter.com/intent/tweet?text= id="你不知道的JavaScript"
>
  Tweet
</a>

<script>
  window.twttr = (function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0],
    t = window.twttr || {};
  if (d.getElementById(id)) return t;
  js = d.createElement(s);
  js.id = id;
  js.src = "https://platform.twitter.com/widgets.js";
  js.async = true;
  fjs.parentNode.insertBefore(js, fjs);

  t._e = [];
  t.ready = function(f) {
    t._e.push(f);
  };

  return t;
}(document, "script", "twitter-wjs"));
</script>

  </section>
</div>


  
    
<section class="article-comment">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>

<script>
  var disqus_shortname = 'drakeleung';
  
  var disqus_url = 'http://yoursite.com/2016/12/29/你不知道的JavaScript（上卷）/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


  
</main>

</body>
</html>
